<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1>fjl-validator-recaptcha</h1><p>ReCaptchaV2 Validator (for backend (nodejs)).</p>
<h2>In this readme:</h2><ul>
<li><a href="#importing-including">Importing/Including</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#usage">Docs</a></li>
<li><a href="#development">Development</a></li>
<li><a href="#resources">Resources</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2>Importing/including:</h2><p>Currently only es6 import is available though you can always require 'babel-register'
at the top of your page to use the module (cjs exported version coming shortly) or you can also build 
your sources which should build the module into the results.</p>
<h2>Usage:</h2><p>The library exports several methods but most notably <code>reCaptchaValidator</code> and <code>reCaptchaValidatorV2</code> are usually the 
ones you'll need.
<code>reCaptchaValidator</code> is curried and takes <code>options</code> parameter first and <code>value</code> parameter second.
<code>reCaptchaValidatorV2</code> takes the <code>value</code> parameter first and <code>options</code> one second (good for the non-functional-programming-style initiates) 
(though note: this version is also curried).</p>
<h3>Callback based:</h3><p>For callback based usage adapt the &quot;Promised based&quot; examples listed below replacing <code>reCaptchaValidator</code> with
 <code>reCaptchaValidator$</code> (which is the callback based, un-curried version of <code>reCaptchaValidator</code>). </p>
<h3>Promised based:</h3><h4>On backend:</h4><pre class="prettyprint source"><code>import {recaptchValidator} from 'fjl-validator-recaptcha';

// Somewhere in application
// ...

const validator = reCaptchaValidator(null); // If no `options` pass `null` when using curried version 
// (un-curried version is `reCaptchaValidator$` and 'value' first version is `reCaptchaValidatorV2`).

router.post('/test-recaptcha-validator', (req, res) => {
    res.type('application/json');
    return validator({
            secret: 'recaptcha-secret-here', 
            response: req.body['g-recaptcha-response'] 
        })
        .then(
            // Send back result of validation
            result => res.json(result),  // {result {Boolean}, messages {Array}}

            // Else, if rejection of promise, send back result of validation
            // And errorCodes for user
            (result, errorCodes) => res.json({result: result, errorCodes})
        );
});</code></pre><p><strong>Overriding error messages:</strong></p>
<pre class="prettyprint source"><code>import {
    INVALID_SUBMISSION,
    MISSING_INPUT_SECRET,
    INVALID_INPUT_SECRET,
    MISSING_INPUT_RESPONSE,
    INVALID_INPUT_RESPONSE,
    BAD_REQUEST,
    UNKNOWN_ERROR,
    reCaptchaValidator
}

// Somewhere in application
const recaptchaValidatorOptions = {
        messageTemplates: {
            // Here you override the specific error-code messages you want
             'invalid-submission': 'The submitted recaptcha submission is ' +
                'invalid/did-not-pass-validation.',

             // You can optionally use the constants setup internally that 
             //  are mapped to error-codes sent back by the recaptcha service; 
             //  The constants are the same as the error codes except uppercase 
             //  and underscore separated (error codes sent back by recatpcha 
             //  service are dash separated and lowercase).
             [MISSING_INPUT_SECRET]: 'The secret parameter is missing.',
             [INVALID_INPUT_SECRET]: 'The secret parameter is invalid or malformed.',
             [MISSING_INPUT_RESPONSE]: 'The response parameter is missing.',
             [INVALID_INPUT_RESPONSE]: 'The response parameter is ' + 
                'invalid or malformed.',
             [BAD_REQUEST]: 'Bad request',
             [UNKNOWN_ERROR]: 'Unknown error.'
        }
    },

    // Can be used this way because it is curried:    
    myReCaptchaValidator = reCaptchaValidator(recaptchaValidatorOptions);

// Elsewhere in your application,

// Handle your recaptcha
// @see reCaptchaV2 frontend: https://developers.google.com/recaptcha/docs/display
// @see reCaptchaV2 backend: https://developers.google.com/recaptcha/docs/verify

router.post('/some-form-endpoint', (req, res) =>
    // Set returning-response type
    res.type('application/json');

    // Validate recaptcha before validating your form or as part of validating your form
    // ...
    return myReCaptchaValidator({secret, response: req.body['g-recaptcha-response']})
        .then(() => {
            // Handle success of form/re-captcha submission 
            // Return appropriate message(s) to the client
            res.json(...);
        })
        .catch((result, errorCodes) => {
            // Return appropriate message(s) to the client
            res.json(...);
        });
);</code></pre><h4>On frontend:</h4><p>On the frontend you'll handle response from the server somewhat like:</p>
<p><strong>Success response:</strong>  Passing validation result object directly, 'un-altered', from server.</p>
<pre class="prettyprint source"><code>{
    &quot;result&quot;: true,
    &quot;messages&quot;: []
}</code></pre><p><strong>Error response (example):</strong> Returning validation result object, with 'errorCodes' key added to it, from server.</p>
<pre class="prettyprint source"><code>{
    &quot;result&quot;: false,
    &quot;messages&quot;: [
        'The secret parameter is invalid or malformed.', 
        'The response parameter is invalid or malformed.'
    ],
    &quot;errorCodes&quot;: [...]
}</code></pre><p><strong>Handling response on frontend (example):</strong></p>
<pre class="prettyprint source"><code>// Preamble
const someForm = document.forms['some-form-name'];
// ... 

// Hit some recaptcha validation endpoint on your server or some form submitting service (some contact-form, or the like, kind-of service/endpoint)
fetch('/validate-recaptcha', { 
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            'g-recaptcha-response': someForm.elements['g-recaptcha-response']
        })
    })
    .then(res => res.json())
    .then(result => {
        if (!result.result) {
            // Message user about error(s) (`messages` will be an array of message strings)
            result.messages.map(...); // 
        }
        // Else submission/validation of form/or-recaptcha was successful
        else {
            // Show success message to user
        }
    );</code></pre><h2>Docs</h2><p>@todo include jsdocs link here</p>
<h2>Members overview:</h2><p>This is just an overview of members included in library.  For in-depth docs view jsdocs located @todo here:</p>
<ul>
<li><code>reCaptchaValidator (options, value)</code> - Makes an IO Request (returns a promise).  Curried.</li>
<li><code>reCaptchaIOValidator (options, value)</code> - Sames <code>reCaptchaValidator</code> just explicitly named.  Curried.</li>
<li><code>reCaptchaValidator$ (options, value, resolve, reject)</code> - Old style/callback based.  Not curried.</li>
<li><code>reCaptchaIOValidator$ (options, value)</code> - Same as <code>reCaptchaIOValidator</code> but not curried.</li>
<li><code>makeReCaptchaRequest$ (options, value, resolve, reject)</code> - Used by all <code>reCaptcha*</code> methods above 
  (makes the request to recaptchaV2 api).  Not curried.  Old style callback based.</li>
<li><code>toReCaptchaValidatorOptions (options)</code> - Returns a normalized <code>reCaptchaValidatorOptions</code> object.</li>
<li><code>toReCaptchaTestValue (options)</code> - Returns a normalized <code>reCaptchaValidatorTestValue</code> object.</li>
</ul>
<h2>Development</h2><ul>
<li>@see package.json &quot;scripts&quot; sections.</li>
<li>@note <code>recaptchaKeys</code> in package.json are the ones prescribed by recaptcha
team for doing <code>always true</code> (response from recaptcha service) testing.</li>
</ul>
<h2>Resources:</h2><h3>ReCaptcha Api links:</h3><ul>
<li>reCaptchaV2 frontend docs: https://developers.google.com/recaptcha/docs/display</li>
<li>reCaptchaV2 backend docs: https://developers.google.com/recaptcha/docs/verify</li>
</ul>
<h2>License:</h2><p>BSD 3 Clause ('./LICENSE' file included in repo).</p></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-fjlValidatorReCaptcha.html">fjlValidatorReCaptcha</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Feb 04 2018 13:15:52 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>